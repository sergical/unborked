{"version":3,"file":"migrate.js","sourceRoot":"/","sources":["db/migrate.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA,6DAAoD;AACpD,iEAA6D;AAC7D,2BAA0B;AAC1B,+CAAiC;AAEjC,MAAM,CAAC,MAAM,EAAE,CAAC;AAEhB,MAAM,IAAI,GAAG,KAAK,IAAI,EAAE;IACtB,iDAAiD;IACjD,MAAM,aAAa,GAAG,IAAI,SAAI,CAAC;QAC7B,gBAAgB,EAAE,OAAO,CAAC,GAAG,CAAC,YAAY;QAC1C,GAAG,EAAE,CAAC,EAAE,8CAA8C;KACvD,CAAC,CAAC;IAEH,IAAI,CAAC;QACH,gCAAgC;QAChC,MAAM,EAAE,GAAG,IAAA,uBAAO,EAAC,aAAa,CAAC,CAAC;QAClC,MAAM,IAAA,kBAAO,EAAC,EAAE,EAAE,EAAE,gBAAgB,EAAE,WAAW,EAAE,CAAC,CAAC;QACrD,OAAO,CAAC,GAAG,CAAC,kCAAkC,CAAC,CAAC;IAClD,CAAC;IAAC,OAAO,KAAK,EAAE,CAAC;QACf,OAAO,CAAC,KAAK,CAAC,mBAAmB,EAAE,KAAK,CAAC,CAAC;QAC1C,MAAM,KAAK,CAAC,CAAC,yCAAyC;IACxD,CAAC;YAAS,CAAC;QACT,2BAA2B;QAC3B,MAAM,aAAa,CAAC,GAAG,EAAE,CAAC;IAC5B,CAAC;AACH,CAAC,CAAC;AAOe,+BAAe;AALhC,mDAAmD;AACnD,IAAI,OAAO,CAAC,IAAI,KAAK,MAAM,EAAE,CAAC;IAC5B,IAAI,EAAE,CAAC,KAAK,CAAC,OAAO,CAAC,KAAK,CAAC,CAAC;AAC9B,CAAC","sourcesContent":["import { drizzle } from 'drizzle-orm/node-postgres';\nimport { migrate } from 'drizzle-orm/node-postgres/migrator';\nimport { Pool } from 'pg';\nimport * as dotenv from 'dotenv';\n\ndotenv.config();\n\nconst main = async () => {\n  // Create a single-connection pool for migrations\n  const migrationPool = new Pool({\n    connectionString: process.env.DATABASE_URL,\n    max: 1, // Use only a single connection for migrations\n  });\n  \n  try {\n    // Run migrations using the pool\n    const db = drizzle(migrationPool);\n    await migrate(db, { migrationsFolder: './drizzle' });\n    console.log('Migration completed successfully');\n  } catch (error) {\n    console.error('Migration failed:', error);\n    throw error; // Re-throw to handle in the calling code\n  } finally {\n    // Close the pool when done\n    await migrationPool.end();\n  }\n};\n\n// Run migrations if this file is executed directly\nif (require.main === module) {\n  main().catch(console.error);\n}\n\nexport { main as migrateDatabase };"]}